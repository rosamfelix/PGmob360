<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pt" xml:lang="pt"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>3&nbsp; Tratamento de dados ‚Äì PG Mobilidade 360</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./interactive-maps.html" rel="next">
<link href="./software.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "Nenhum resultado",
    "search-matching-documents-text": "documentos correspondentes",
    "search-copy-link-title": "Copiar link para a busca",
    "search-hide-matches-text": "Esconder correspond√™ncias adicionais",
    "search-more-match-text": "mais correspond√™ncia neste documento",
    "search-more-matches-text": "mais correspond√™ncias neste documento",
    "search-clear-button-title": "Limpar",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancelar",
    "search-submit-button-title": "Enviar",
    "search-label": "Procurar"
  }
}</script>


<meta name="citation_title" content="[3]{.chapter-number}&nbsp; [Tratamento de dados]{.chapter-title}">
<meta name="citation_language" content="pt">
<meta name="citation_reference" content="citation_title=Literate Programming;,citation_author=Donald E. Knuth;,citation_publication_date=1984;,citation_cover_date=1984;,citation_year=1984;,citation_fulltext_html_url=https://doi.org/10.1093/comjnl/27.2.97;,citation_issue=2;,citation_doi=10.1093/comjnl/27.2.97;,citation_issn=0010-4620;,citation_volume=27;,citation_journal_title=Comput. J.;,citation_publisher=Oxford University Press, Inc.;">
<meta name="citation_reference" content="citation_title=Mobilidade e funcionalidade do territ√≥rio nas √Åreas Metropolitanas do Porto e de Lisboa: 2017;,citation_author=undefined INE;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_fulltext_html_url=https://www.ine.pt/xportal/xmain?xpid=INE&amp;amp;amp;xpgid=ine_publicacoes&amp;PUBLICACOESpub_boui=349495406&amp;PUBLICACOESmodo=2&amp;xlang=pt;,citation_isbn=978-989-25-0478-0;,citation_technical_report_institution=Instituto National de Estat√≠stica;">
<meta name="citation_reference" content="citation_title=Censos 2021- XVI Recenseamento Geral da Popula√ß√£o. VI Recenseamento Geral da Habita√ß√£o;,citation_author=undefined INE;,citation_publication_date=2022;,citation_cover_date=2022;,citation_year=2022;,citation_fulltext_html_url=https://censos.ine.pt/xurl/pub/65586079;,citation_isbn=978-989-25-0619-7;,citation_technical_report_institution=Instituto National de Estat√≠stica;">
<meta name="citation_reference" content="citation_title=Spatial Data Science: With Applications in R;,citation_author=Edzer Pebesma;,citation_author=Roger Bivand;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://doi.org/10.1201/9780429459016;,citation_doi=10.1201/9780429459016;">
<meta name="citation_reference" content="citation_title=Jittering: A Computationally Efficient Method for Generating Realistic Route Networks from Origin-Destination Data;,citation_author=Robin Lovelace;,citation_author=Rosa F√©lix;,citation_author=Dustin Carlino;,citation_publication_date=2022-04-08;,citation_cover_date=2022-04-08;,citation_year=2022;,citation_doi=10.32866/001c.33873;,citation_journal_title=Findings;,citation_publisher=Findings Press;">
<meta name="citation_reference" content="citation_title=r5r: Rapid Realistic Routing on Multimodal Transport Networks with R&amp;amp;amp;lt;sup&amp;gt;5&amp;lt;/sup&amp;gt; in R;,citation_author=Rafael H. M. Pereira;,citation_author=Marcus Saraiva;,citation_author=Daniel Herszenhut;,citation_author=Carlos Kaue Vieira Braga;,citation_author=Matthew Wigginton Conway;,citation_publication_date=2021-03-04;,citation_cover_date=2021-03-04;,citation_year=2021;,citation_doi=10.32866/001c.21262;,citation_journal_title=Findings;,citation_publisher=Findings Press;">
<meta name="citation_reference" content="citation_title=centr: Weighted and Unweighted Spatial Centers;,citation_author=Ryan Zomorrodi;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://ryanzomorrodi.github.io/centr/;">
<meta name="citation_reference" content="citation_title=stplanr: A Package for Transport Planning;,citation_author=Robin Lovelace;,citation_author=Richard Ellison;,citation_publication_date=2018;,citation_cover_date=2018;,citation_year=2018;,citation_issue=2;,citation_doi=10.32614/RJ-2018-053;,citation_volume=10;,citation_journal_title=The R Journal;">
<meta name="citation_reference" content="citation_title=od: Manipulate and Map Origin-Destination Data;,citation_author=Robin Lovelace;,citation_author=Malcolm Morgan;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://github.com/itsleeds/od;">
<meta name="citation_reference" content="citation_title=Introduction to R;,citation_author=Claudia A Engel;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=cengel.github.io/R-intro/;">
<meta name="citation_reference" content="citation_title=Geocomputation with R;,citation_author=Robin Lovelace;,citation_author=Jakub Nowosad;,citation_author=Jannes Muenchow;,citation_publication_date=2024;,citation_cover_date=2024;,citation_year=2024;,citation_fulltext_html_url=https://r.geocompx.org/;">
<meta name="citation_reference" content="citation_title=Introduction to urban accessibility: a practical guide with R;,citation_author=Rafael HM Pereira;,citation_author=Daniel Herszenhut;,citation_publication_date=2023;,citation_cover_date=2023;,citation_year=2023;,citation_fulltext_html_url=https://ipeagit.github.io/intro_access_book/;">
<meta name="citation_reference" content="citation_title=Guide: The Open Data Consumer Checklist;,citation_author=The Open Data Institute;,citation_publication_date=2013;,citation_cover_date=2013;,citation_year=2013;,citation_fulltext_html_url=https://theodi.org/insights/guides/the-open-data-consumer-checklist/;">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./data-manipulation.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tratamento de dados</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Alternar barra lateral" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Procurar" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">PG Mobilidade 360</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/rosamfelix/PGmob360" title="C√≥digo fonte" class="quarto-navigation-tool px-1" aria-label="C√≥digo fonte"><i class="bi bi-github"></i></a>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Alternar modo escuro"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Procurar"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">In√≠cio</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./summary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Planeamento</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./software.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Software</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-manipulation.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tratamento de dados</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./interactive-maps.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Mapas interativos</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./open-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Dados Abertos em transportes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./road-networks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Redes Vi√°rias</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./gtfs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">GTFS</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./r5r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Acessibilidade com r5r</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./about.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Sobre</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Refer√™ncias</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="3">
    <h2 id="toc-title">√çndice</h2>
   
  <ul>
  <li><a href="#selecionar-vari√°veis" id="toc-selecionar-vari√°veis" class="nav-link active" data-scroll-target="#selecionar-vari√°veis"><span class="header-section-number">3.1</span> Selecionar vari√°veis</a>
  <ul class="collapse">
  <li><a href="#usando-pipes" id="toc-usando-pipes" class="nav-link" data-scroll-target="#usando-pipes"><span class="header-section-number">3.1.1</span> Usando pipes!</a></li>
  </ul></li>
  <li><a href="#filtrar-observa√ß√µes" id="toc-filtrar-observa√ß√µes" class="nav-link" data-scroll-target="#filtrar-observa√ß√µes"><span class="header-section-number">3.2</span> Filtrar observa√ß√µes</a></li>
  <li><a href="#criar-novas-vari√°veis" id="toc-criar-novas-vari√°veis" class="nav-link" data-scroll-target="#criar-novas-vari√°veis"><span class="header-section-number">3.3</span> Criar novas vari√°veis</a></li>
  <li><a href="#alterar-o-tipo-de-dados" id="toc-alterar-o-tipo-de-dados" class="nav-link" data-scroll-target="#alterar-o-tipo-de-dados"><span class="header-section-number">3.4</span> Alterar o tipo de dados</a>
  <ul class="collapse">
  <li><a href="#factores" id="toc-factores" class="nav-link" data-scroll-target="#factores"><span class="header-section-number">3.4.1</span> Factores</a></li>
  </ul></li>
  <li><a href="#juntar-tabelas-de-dados" id="toc-juntar-tabelas-de-dados" class="nav-link" data-scroll-target="#juntar-tabelas-de-dados"><span class="header-section-number">3.5</span> Juntar tabelas de dados</a></li>
  <li><a href="#group_by-e-summarize" id="toc-group_by-e-summarize" class="nav-link" data-scroll-target="#group_by-e-summarize"><span class="header-section-number">3.6</span> group_by e summarize</a></li>
  <li><a href="#organizar-os-dados" id="toc-organizar-os-dados" class="nav-link" data-scroll-target="#organizar-os-dados"><span class="header-section-number">3.7</span> Organizar os dados</a></li>
  <li><a href="#all-together-now" id="toc-all-together-now" class="nav-link" data-scroll-target="#all-together-now"><span class="header-section-number">3.8</span> All together now!</a></li>
  <li><a href="#outras-fun√ß√µes-do-dplyr" id="toc-outras-fun√ß√µes-do-dplyr" class="nav-link" data-scroll-target="#outras-fun√ß√µes-do-dplyr"><span class="header-section-number">3.9</span> Outras fun√ß√µes do dplyr</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tratamento de dados</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source"><i class="bi"></i> C√≥digo</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>Neste cap√≠tulo, utilizaremos algumas fun√ß√µes muito √∫teis do <code>dplyr</code> para tratar e manipular dados.</p>
<p>Pode carregar o pacote <code>dplyr</code> diretamente ou carregar todo o universo tidy (<code>tidyverse</code>) que cont√©m outros pacotes como o <code>ggplot2</code> para fazer gr√°ficos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyverse)</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Iremos usar uma base de dados do IMOB <span class="citation" data-cites="IMOB">(<a href="references.html#ref-IMOB" role="doc-biblioref">INE 2018</a>)</span> com as viagens entre freguesias da √°rea metropolitana de Lisboa, por modo de transporte.</p>
<p>Faremos um tratamento de dados de forma simplificada, usando as mais recentes boas-pr√°ticas de utiliza√ß√£o de linguagem R.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ler os dados diretamente em formato R dataset</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>TRIPS <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"data/TRIPSorigem.Rds"</span>)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Importante
</div>
</div>
<div class="callout-body-container callout-body">
<p>Note que √© muito importante compreender o R base, mesmo que as fun√ß√µes seguintes forne√ßam os mesmos resultados.</p>
</div>
</div>
<p>N√£o √© necess√°rio saber tudo! E <strong>n√£o precisa de saber de cor</strong>. As fun√ß√µes seguintes s√£o as que provavelmente utilizar√° na maior parte das vezes para tratar dados.</p>
<div class="callout callout-style-simple callout-tip">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>Existem v√°rias formas de chegar √† mesma solu√ß√£o. Aqui apresento apenas uma delas.</p>
</div>
</div>
</div>
<section id="selecionar-vari√°veis" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="selecionar-vari√°veis"><span class="header-section-number">3.1</span> Selecionar vari√°veis</h2>
<p>D√™ uma vista de olhos ao seu conjunto de dados. Pode abrir a tabela utilizando <code>View()</code>, ver a informa√ß√£o no painel ‚ÄúEnvironment‚Äù, ou mesmo <em>imprimir</em> o conte√∫do estruturado com <code>glimpse()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(TRIPS)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 236
Columns: 9
$ Origem   &lt;chr&gt; "110501", "110501", "110506", "110506", "110507", "110507", "‚Ä¶
$ Total    &lt;dbl&gt; 35539, 47602, 37183, 42313, 30725, 54586, 57747, 67884, 940, ‚Ä¶
$ Walk     &lt;dbl&gt; 11325, 3502, 12645, 1418, 9389, 2630, 20423, 3573, 623, 1738,‚Ä¶
$ Bike     &lt;dbl&gt; 1309, 416, 40, 163, 1481, 168, 1406, 809, 13, 37, 3, 139, 0, ‚Ä¶
$ Car      &lt;dbl&gt; 21446, 37727, 22379, 37337, 19654, 44611, 33044, 52251, 192, ‚Ä¶
$ PTransit &lt;dbl&gt; 1460, 5519, 2057, 3285, 201, 6963, 2477, 10534, 110, 4836, 93‚Ä¶
$ Other    &lt;dbl&gt; 0, 437, 63, 106, 0, 215, 396, 717, 2, 169, 3, 824, 0, 324, 0,‚Ä¶
$ Interna  &lt;dbl&gt; 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1, 0‚Ä¶
$ Lisboa   &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1‚Ä¶</code></pre>
</div>
</div>
<p>Vamos criar um novo conjunto de dados com <em>Origem</em>, <em>Walk,</em> <em>Bike</em> e <em>Total</em>. Usamos a fun√ß√£o <code>select()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>TRIPS_new <span class="ot">=</span> <span class="fu">select</span>(TRIPS, Origem, Walk, Bike, Total) <span class="co"># o primeiro argumento √© a base de dados</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Em R, o primeiro argumento √© normalmente referente ao conjunto de dados, e os restantes s√£o as colunas a selecionar.</p>
<p>Com o <code>dplyr</code> n√£o √© necess√°rio referir a <code>data$...</code> , podemos simplesmente escrever os nomes das vari√°veis (e mesmo sem o <code>‚Äú...‚Äù</code>!). Isto torna o c√≥digo em R mais simples üôÇ</p>
<p>Com o <code>select()</code> podemos tamb√©m remover colunas que n√£o precisamos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>TRIPS_new <span class="ot">=</span> <span class="fu">select</span>(TRIPS_new, <span class="sc">-</span>Total) <span class="co"># deixar cair a vari√°vel Total</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="usando-pipes" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="usando-pipes"><span class="header-section-number">3.1.1</span> Usando pipes!</h3>
<p>Agora vamos passar a usar os <em>pipes</em>. Os <em>pipes</em> funcionam como uma regra: ‚Äú<strong>Com isto, faz isto.</strong>‚Äù</p>
<p>Isto √© √∫til para omitir o primeiro argumento das fun√ß√µes (normalmente o conjunto de dados para aplicar a fun√ß√£o).</p>
<p>Com o mesmo exemplo do <code>select()</code>, podemos escrever como:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>TRIPS_new <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">select</span>(Origem, Walk, Bike, Total)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Duas coisas a <strong>ter em conta</strong>:</p>
<ol type="1">
<li><p>O s√≠mbolo do <em>pipe</em> pode ser escrito como <code>|&gt;</code> ou <code>%&gt;%</code>.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Para o escrever, pode tamb√©m utilizar o atalho <code>ctrl+shift+m</code>.</p></li>
<li><p>Depois de escrever <code>select(</code> pode premir <code>tab</code> e aparecer√° a lista de vari√°veis dispon√≠veis desse conjunto de dados! Prima <code>Enter</code> para selecionar. Desta forma, evita erros de digita√ß√£o.</p></li>
</ol>
</section>
</section>
<section id="filtrar-observa√ß√µes" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="filtrar-observa√ß√µes"><span class="header-section-number">3.2</span> Filtrar observa√ß√µes</h2>
<p>Podemos filtrar observa√ß√µes, com base numa condi√ß√£o, utilizando a fun√ß√£o <code>filter()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPS[TRIPS<span class="sc">$</span>Total <span class="sc">&gt;</span> <span class="dv">25000</span>,] <span class="co"># usando o r-base, n√£o se pode esquecer a v√≠rgula</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPS2 <span class="sc">|&gt;</span> <span class="fu">filter</span>(Total <span class="sc">&gt;</span> <span class="dv">25000</span>) <span class="co"># usando o dplyr, √© mais f√°cil</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>√â poss√≠vel ter outras condi√ß√µes dentro da condi√ß√£o.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(TRIPS<span class="sc">$</span>Total)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
    361    5918   17474   22457   33378  112186 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>TRIPS3 <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">filter</span>(Total <span class="sc">&gt;</span> <span class="fu">median</span>(Total)) </span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Outras condi√ß√µes de filtragem:</p>
<ul>
<li><code>==</code> igual, <code>!=</code> diferente</li>
<li><code>&lt;</code> menor, <code>&gt;</code> maior, <code>&lt;=</code> menor ou igual, <code>&gt;=</code> maior ou igual</li>
<li><code>&amp;</code> e, <code>|</code> ou</li>
<li><code>is.na</code>, <code>!is.na</code> n√£o √© NA</li>
<li><code>%in%</code>, <code>!%in%</code> n√£o est√° em</li>
</ul>
</section>
<section id="criar-novas-vari√°veis" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="criar-novas-vari√°veis"><span class="header-section-number">3.3</span> Criar novas vari√°veis</h2>
<p>Tamb√©m podemos tentar criar uma vari√°vel de percentagem de viagens em autom√≥vel (<em>Car</em>) usando pipes! Para criar uma nova vari√°vel ou alterar uma existente (overwrite), podemos usar a fun√ß√£o <code>mutate()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>TRIPS<span class="sc">$</span>Car_perc <span class="ot">=</span> TRIPS<span class="sc">$</span>Car<span class="sc">/</span>TRIPS<span class="sc">$</span>Total <span class="sc">*</span> <span class="dv">100</span> <span class="co"># com o r-base</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>TRIPS <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Car_perc =</span> Car<span class="sc">/</span>Total <span class="sc">*</span> <span class="dv">100</span>) <span class="co"># com o dplyr</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="alterar-o-tipo-de-dados" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="alterar-o-tipo-de-dados"><span class="header-section-number">3.4</span> Alterar o tipo de dados</h2>
<p>Os dados podem estar em diferentes formatos. Por exemplo, a vari√°vel <em>Origem</em> tem os c√≥digos das freguesias como texto (<em>character</em>), mas podemos convert√™-la numa vari√°vel num√©rica.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(TRIPS<span class="sc">$</span>Origem)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "character"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>TRIPS <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> </span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Origem_num =</span> <span class="fu">as.integer</span>(Origem)) <span class="co"># tamb√©m podemos usar as.numeric()</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(TRIPS<span class="sc">$</span>Origem_num)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "integer"</code></pre>
</div>
</div>
<p>Os tipos de dados mais utilizados s√£o:</p>
<ul>
<li>inteiro / integer (<code>int</code>)</li>
<li>num√©rico / numeric (<code>num</code>)</li>
<li>texto/ character (<code>chr</code>)</li>
<li>l√≥gico / logical (<code>logical</code>)</li>
<li>data / date (<code>Date</code>)</li>
<li>factor (<code>factor</code>)</li>
</ul>
<section id="factores" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="factores"><span class="header-section-number">3.4.1</span> Factores</h3>
<p>Os factores s√£o √∫teis para lidar com dados categ√≥ricos. Podemos converter um texto num fator usando <code>as.factor()</code>, e tamb√©m atribuir etiquetas e n√≠veis para dados categ√≥ricos ordinais.</p>
<p>Podemos alterar a vari√°vel <code>Lisbon</code> para um factor, e a vari√°vel <code>Internal</code> tamb√©m.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>TRIPS <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Lisboa_factor =</span> <span class="fu">factor</span>(Lisboa, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"N√£o"</span>, <span class="st">"Sim"</span>)),</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">Interna_factor =</span> <span class="fu">factor</span>(Interna, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Externa"</span>, <span class="st">"Interna"</span>)))</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Mas como saber qual o n√≠vel que vem primeiro? Uma forma simples √© utilizar as fun√ß√µes <code>table()</code> ou <code>unique()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(TRIPS<span class="sc">$</span>Lisboa) <span class="co"># isto mostra todos os valores √∫nicos (diferentes)</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(TRIPS<span class="sc">$</span>Lisboa) <span class="co"># isto mostra a frequ√™ncia de cada valor</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  0   1 
188  48 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(TRIPS<span class="sc">$</span>Lisboa_factor)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
N√£o Sim 
188  48 </code></pre>
</div>
</div>
<p>O primeiro n√∫mero a aparecer corresponde ao primeiro n√≠vel, e assim sucessivamente.</p>
<p>Podemos ver a diferen√ßa entre usar uma vari√°vel cont√≠nua (neste caso, <code>Lisboa</code> tem 0 e 1) e uma vari√°vel categ√≥rica (<code>Lisboa_factor</code>).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TRIPS<span class="sc">$</span>Lisboa) <span class="co"># os valores variam entre 0 e 1</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="data-manipulation_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TRIPS<span class="sc">$</span>Lisboa_factor) <span class="co"># os valores s√£o categ√≥ricos e com etiquetas Sim/N√£o</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="data-manipulation_files/figure-html/unnamed-chunk-14-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="juntar-tabelas-de-dados" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="juntar-tabelas-de-dados"><span class="header-section-number">3.5</span> Juntar tabelas de dados</h2>
<p>Quando temos tabelas relacionais - ou seja, com um identificador comum - √© √∫til poder junt√°-las de uma forma eficiente.</p>
<p>O <code>left_join</code> √© uma fun√ß√£o que junta duas tabelas atrav√©s de <strong>uma vari√°vel comum</strong>. A <strong>primeira tabela √© a que ser√° mantida</strong>, e a <strong>segunda ser√° acrescentada a ela</strong>. Como funciona o <code>left_join</code>:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="https://r4ds.hadley.nz/joins#fig-join-left"><img src="images/clipboard-1594422253.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="424" alt="Uma representa√ß√£o visual do left_join em que todas as linhas de x aparecem no resultado final, com mais informa√ß√£o junta de y. Fonte: Engel (2023)."></a></p>
</figure>
</div>
<figcaption>Uma representa√ß√£o visual do <code>left_join</code> em que todas as linhas de x aparecem no resultado final, com mais informa√ß√£o junta de y. Fonte: <span class="citation" data-cites="intror">Engel (<a href="references.html#ref-intror" role="doc-biblioref">2023</a>)</span>.</figcaption>
</figure>
</div>
<p>Vamos ent√£o <strong>juntar a lista de munic√≠pios √† nossa tabela</strong>, atrav√©s de uma outra base de dados que inclui a <strong>rela√ß√£o</strong> entre o c√≥digo de freguesias (dicofre), o nome das freguesias e os respetivos munic√≠pios.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>Municipios <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"data/Municipios_nomes.Rds"</span>)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TRIPS)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 13
  Origem Total  Walk  Bike   Car PTransit Other Interna Lisboa Car_perc
  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
1 110501 35539 11325  1309 21446     1460     0       0      0     60.3
2 110501 47602  3502   416 37727     5519   437       1      0     79.3
3 110506 37183 12645    40 22379     2057    63       0      0     60.2
4 110506 42313  1418   163 37337     3285   106       1      0     88.2
5 110507 30725  9389  1481 19654      201     0       0      0     64.0
6 110507 54586  2630   168 44611     6963   215       1      0     81.7
# ‚Ñπ 3 more variables: Origem_num &lt;int&gt;, Lisboa_factor &lt;fct&gt;,
#   Interna_factor &lt;fct&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(Municipios)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    DTCC Dicofre            Concelho
113 1109  110913               Mafra
114 1114  111409 Vila Franca de Xira
115 1109  110918               Mafra
116 1109  110904               Mafra
117 1502  150202           Alcochete
118 1109  110911               Mafra
                                                Freguesia
113                                         Santo Isidoro
114                                   Vila Franca de Xira
115 Uni√£o das freguesias de Azueira e Sobral da Abelheira
116                                            Encarna√ß√£o
117                                               Samouco
118                                             Milharado</code></pre>
</div>
</div>
<p>Podemos observar que as tabelas t√™m vari√°veis comuns: a <code>Origem</code> em <code>TRIPS</code> e o <code>Dicofre</code> em <code>Municipios</code>.</p>
<p>Uma vez que o nome da vari√°vel n√£o √© o mesmo, para juntar estas duas tabelas precisamos de especificar a vari√°vel comum em cada tabela, utilizando o argumento <code>by</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>TRIPSjoin <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">left_join</span>(Municipios, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Origem"</span> <span class="ot">=</span> <span class="st">"Dicofre"</span>))</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Se preferir, pode alterar ou renomear uma vari√°vel para que ambas as tabelas tenham o mesmo nome. <strong>Quando ambas as tabelas t√™m o mesmo nome de vari√°vel</strong>, n√£o √© preciso especificar o argumento <code>by</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>Municipios <span class="ot">=</span> Municipios <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Origem =</span> <span class="st">"Dicofre"</span>) <span class="co"># alterar o nome da vari√°vel</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>TRIPSjoin <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">left_join</span>(Municipios) <span class="co"># detecta automativamente a vari√°vel comum</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p>Como √© poss√≠vel observar, as duas tabelas n√£o precisam de ter o mesmo n√∫mero de linhas (<code>nrow()</code>). A fun√ß√£o <code>left_join</code> mant√©m todas as observa√ß√µes da primeira tabela e junta a segunda tabela a esta. Se n√£o houver correspond√™ncia, as vari√°veis da segunda tabela ser√£o preenchidas com <code>NA</code>.</p>
</blockquote>
</section>
<section id="group_by-e-summarize" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="group_by-e-summarize"><span class="header-section-number">3.6</span> group_by e summarize</h2>
<p>Temos uma tabela grande com todas as freguesias da AML e os seus respectivos munic√≠pios. Queremos agora saber o n√∫mero total de viagens com origem em cada munic√≠pio.</p>
<p>Para facilitar, vamos manter apenas as vari√°veis de que precisamos para chegar ao resultado.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>TRIPSredux <span class="ot">=</span> TRIPSjoin <span class="sc">|&gt;</span> <span class="fu">select</span>(Origem, Concelho, Interna, Car, Total)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TRIPSredux)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 5
  Origem Concelho Interna   Car Total
  &lt;chr&gt;  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
1 110501 Cascais        0 21446 35539
2 110501 Cascais        1 37727 47602
3 110506 Cascais        0 22379 37183
4 110506 Cascais        1 37337 42313
5 110507 Cascais        0 19654 30725
6 110507 Cascais        1 44611 54586</code></pre>
</div>
</div>
<p>Podemos agrupar esta tabela pela vari√°vel <code>Concelho</code> e sumarizar (<em>summarize</em>) o n√∫mero de viagens com origem em cada munic√≠pio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>TRIPSsum <span class="ot">=</span> TRIPSredux <span class="sc">|&gt;</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Concelho) <span class="sc">|&gt;</span> <span class="co"># n√£o ir√° notar nenhuma altera√ß√£o na tabela</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total))</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TRIPSsum)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 2
  Concelho    Total
  &lt;chr&gt;       &lt;dbl&gt;
1 Alcochete   36789
2 Almada     289834
3 Amadora    344552
4 Barreiro   133658
5 Cascais    373579
6 Lisboa    1365111</code></pre>
</div>
</div>
<p>Som√°mos o n√∫mero total de viagens em cada munic√≠pio.</p>
<p>Se quisermos agrupar por mais do que uma vari√°vel, podemos adicionar mais vari√°veis ao <code>group_by()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>TRIPSsum2 <span class="ot">=</span> TRIPSredux <span class="sc">|&gt;</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Concelho, Interna) <span class="sc">|&gt;</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total),</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">Car =</span> <span class="fu">sum</span>(Car))</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TRIPSsum2)</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 √ó 4
# Groups:   Concelho [3]
  Concelho  Interna  Total    Car
  &lt;chr&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
1 Alcochete       0  16954   9839
2 Alcochete       1  19835  15632
3 Almada          0 105841  49012
4 Almada          1 183993 125091
5 Amadora         0 117727  33818
6 Amadora         1 226825 142386</code></pre>
</div>
</div>
<p>Som√°mos o n√∫mero total de viagens e viagens em autom√≥vel para cada munic√≠pio, discriminadas por desloca√ß√µes internas e externas.</p>
<div class="callout callout-style-simple callout-caution">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-body-container">
<p>√â uma boa pr√°tica utilizar a fun√ß√£o <code>ungroup()</code> ap√≥s a fun√ß√£o <code>group_by()</code>. Isso remover√° o agrupamento. Se n√£o o fizer, o agrupamento ser√° mantido e poder√° obter resultados inesperados na pr√≥xima vez que utilizar esse conjunto de dados.</p>
</div>
</div>
</div>
</section>
<section id="organizar-os-dados" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="organizar-os-dados"><span class="header-section-number">3.7</span> Organizar os dados</h2>
<p>Podemos <strong>ordenar</strong> (<em>sort</em>) um conjunto de dados por uma ou mais vari√°veis.</p>
<p>Por exemplo, <code>arrange()</code> por Total de viagens, na ordem ascendente ou descendente.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPSsum2 <span class="sc">|&gt;</span> <span class="fu">arrange</span>(Total)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPSsum2 <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="sc">-</span>Total) <span class="co"># descendente</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPSsum2 <span class="sc">|&gt;</span> <span class="fu">arrange</span>(Concelho) <span class="co"># alfab√©tica</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>TRIPS4 <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">arrange</span>(Lisboa_factor, Total) <span class="co"># mais de uma vari√°vel</span></span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Isto n√£o √© o mesmo que abrir a tabela de visualiza√ß√£o e clicar nas setas das vari√°veis. Quando se faz isso, a ordem n√£o √© guardada no conjunto de dados. Se quiser guardar a ordem, dever√° usar a fun√ß√£o <code>arrange()</code>.</p>
</section>
<section id="all-together-now" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="all-together-now"><span class="header-section-number">3.8</span> All together now!</h2>
<p>Esta √© a magia dos <em>pipes</em>. O pipe pega no √∫ltimo resultado e aplica-lhe a fun√ß√£o seguinte. ‚ÄúCom isto, faz isto.‚Äù. Podemos encadear as fun√ß√µes que quisermos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>TRIPS_pipes <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Origem, Interna, Car, Total) <span class="sc">|&gt;</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Dicofre =</span> Origem) <span class="sc">|&gt;</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Interna_factor =</span> <span class="fu">factor</span>(Interna, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Externa"</span>, <span class="st">"Interna"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Interna_factor <span class="sc">==</span> <span class="st">"Interna"</span>)<span class="sc">|&gt;</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Municipios) <span class="sc">|&gt;</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Concelho) <span class="sc">|&gt;</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total),</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>            <span class="at">Car =</span> <span class="fu">sum</span>(Car),</span>
<span id="cb40-14"><a href="#cb40-14" aria-hidden="true" tabindex="-1"></a>            <span class="at">Car_perc =</span> Car<span class="sc">/</span>Total <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb40-15"><a href="#cb40-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb40-16"><a href="#cb40-16" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb40-17"><a href="#cb40-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Car_perc))</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Com este c√≥digo, teremos uma tabela com o n√∫mero total de viagens intramunicipais, por munic√≠pio, com os seus nomes em vez de c√≥digos, ordenados pela percentagem de viagens em autom√≥vel.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>TRIPS_pipes</span></code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 √ó 4
   Concelho              Total    Car Car_perc
   &lt;chr&gt;                 &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
 1 Montijo               42042  36089     85.8
 2 Mafra                 60221  51233     85.1
 3 Set√∫bal              110348  90837     82.3
 4 Cascais              212385 171926     81.0
 5 Sesimbra              39541  31238     79.0
 6 Oeiras               203313 160554     79.0
 7 Alcochete             19835  15632     78.8
 8 Palmela               65825  49403     75.1
 9 Sintra               322539 237954     73.8
10 Vila Franca de Xira   97596  71482     73.2
11 Loures               213336 155238     72.8
12 Moita                 47472  33754     71.1
13 Barreiro              80696  56003     69.4
14 Seixal               145532  99532     68.4
15 Almada               183993 125091     68.0
16 Odivelas             155468 102812     66.1
17 Amadora              226825 142386     62.8
18 Lisboa              1085032 585823     54.0</code></pre>
</div>
</div>
</section>
<section id="outras-fun√ß√µes-do-dplyr" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="outras-fun√ß√µes-do-dplyr"><span class="header-section-number">3.9</span> Outras fun√ß√µes do dplyr</h2>
<p>Pode explorar outras fun√ß√µes e varia√ß√µes do <code>dplyr</code> para manipula√ß√£o de dados na <strong>dplyr cheatsheet</strong>:</p>
<p><a href="https://rstudio.github.io/cheatsheets/data-transformation.pdf"><img src="images/clipboard-2101323289.png" class="img-fluid"></a></p>
<p>Take a particular attention to <code>pivot_wider</code> and <code>pivot_longer</code> (<a href="https://tidyr.tidyverse.org/articles/pivot.html"><code>tidyr</code></a> package) to transform <strong>OD matrices</strong> in <strong>wide</strong> and <strong>long</strong> formats.</p>
<p>Tome especial aten√ß√£o a <code>pivot_wider</code> e <code>pivot_longer</code> (pacote <a href="https://tidyr.tidyverse.org/articles/pivot.html"><code>tidyr</code></a> ) para transformar <strong>matrizes OD</strong> em formatos largos (<em>wide</em>) ou longos (<em>long</em>).</p>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>Matriz OD em formato longo</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Origens</th>
<th style="text-align: left;">Destinos</th>
<th style="text-align: right;">Viagens</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: left;">B</td>
<td style="text-align: right;">20</td>
</tr>
<tr class="even">
<td style="text-align: left;">A</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="odd">
<td style="text-align: left;">B</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">10</td>
</tr>
<tr class="even">
<td style="text-align: left;">C</td>
<td style="text-align: left;">C</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: left;">A</td>
<td style="text-align: right;">30</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell">
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>matriz OD em formato wide</caption>
<thead>
<tr class="header">
<th style="text-align: left;">Viagens</th>
<th style="text-align: right;">A</th>
<th style="text-align: right;">B</th>
<th style="text-align: right;">C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">A</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">20</td>
<td style="text-align: right;">45</td>
</tr>
<tr class="even">
<td style="text-align: left;">B</td>
<td style="text-align: right;">10</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">NA</td>
</tr>
<tr class="odd">
<td style="text-align: left;">C</td>
<td style="text-align: right;">30</td>
<td style="text-align: right;">NA</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>
</div>
</div>


<!-- -->

<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-intror" class="csl-entry" role="listitem">
Engel, Claudia A. 2023. <em>Introduction to R</em>. <a href="https://cengel.github.io/R-intro/">cengel.github.io/R-intro/</a>.
</div>
<div id="ref-IMOB" class="csl-entry" role="listitem">
INE. 2018. <span>¬´Mobilidade e funcionalidade do territ√≥rio nas <span>√Åreas Metropolitanas do Porto e de Lisboa</span>: 2017¬ª</span>. Lisboa: <span>Instituto National de Estat√≠stica</span>. <a href="https://www.ine.pt/xportal/xmain?xpid=INE&amp;xpgid=ine_publicacoes&amp;PUBLICACOESpub_boui=349495406&amp;PUBLICACOESmodo=2&amp;xlang=pt">https://www.ine.pt/xportal/xmain?xpid=INE&amp;xpgid=ine_publicacoes&amp;PUBLICACOESpub_boui=349495406&amp;PUBLICACOESmodo=2&amp;xlang=pt</a>.
</div>
</div>
</section>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>Pode alterar isto em RStudio &gt; Tools &gt; Global Options &gt; Code.<a href="#fnref1" class="footnote-back" role="doc-backlink">‚Ü©Ô∏é</a></p></li>
</ol>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "Óßã";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copiada");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copiada");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./software.html" class="pagination-link" aria-label="Software">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Software</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./interactive-maps.html" class="pagination-link" aria-label="Mapas interativos">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Mapas interativos</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">C√≥digo fonte</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb43" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="an">eval:</span><span class="co"> true</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="an">code-fold:</span><span class="co"> false</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="an">engine:</span><span class="co"> knitr</span></span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-7"><a href="#cb43-7" aria-hidden="true" tabindex="-1"></a><span class="fu"># Tratamento de dados</span></span>
<span id="cb43-8"><a href="#cb43-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-9"><a href="#cb43-9" aria-hidden="true" tabindex="-1"></a>Neste cap√≠tulo, utilizaremos algumas fun√ß√µes muito √∫teis do <span class="in">`dplyr`</span> para tratar e manipular dados.</span>
<span id="cb43-10"><a href="#cb43-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-11"><a href="#cb43-11" aria-hidden="true" tabindex="-1"></a>Pode carregar o pacote <span class="in">`dplyr`</span> diretamente ou carregar todo o universo tidy (<span class="in">`tidyverse`</span>) que cont√©m outros pacotes como o <span class="in">`ggplot2`</span> para fazer gr√°ficos.</span>
<span id="cb43-12"><a href="#cb43-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-15"><a href="#cb43-15" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-16"><a href="#cb43-16" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb43-17"><a href="#cb43-17" aria-hidden="true" tabindex="-1"></a><span class="co"># library(tidyverse)</span></span>
<span id="cb43-18"><a href="#cb43-18" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb43-19"><a href="#cb43-19" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-20"><a href="#cb43-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-21"><a href="#cb43-21" aria-hidden="true" tabindex="-1"></a>Iremos usar uma base de dados do IMOB <span class="co">[</span><span class="ot">@IMOB</span><span class="co">]</span> com as viagens entre freguesias da √°rea metropolitana de Lisboa, por modo de transporte.</span>
<span id="cb43-22"><a href="#cb43-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-23"><a href="#cb43-23" aria-hidden="true" tabindex="-1"></a>Faremos um tratamento de dados de forma simplificada, usando as mais recentes boas-pr√°ticas de utiliza√ß√£o de linguagem R.</span>
<span id="cb43-24"><a href="#cb43-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-27"><a href="#cb43-27" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-28"><a href="#cb43-28" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb43-29"><a href="#cb43-29" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb43-30"><a href="#cb43-30" aria-hidden="true" tabindex="-1"></a><span class="co"># data preparation</span></span>
<span id="cb43-31"><a href="#cb43-31" aria-hidden="true" tabindex="-1"></a>TABLE <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="fu">url</span>(<span class="st">"https://github.com/U-Shift/MQAT/raw/main/data/IMOBmodel0.Rds"</span>))</span>
<span id="cb43-32"><a href="#cb43-32" aria-hidden="true" tabindex="-1"></a>TABLE <span class="ot">=</span> TABLE <span class="sc">|&gt;</span> </span>
<span id="cb43-33"><a href="#cb43-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Origem =</span> <span class="st">"Origem_dicofre16"</span>,</span>
<span id="cb43-34"><a href="#cb43-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">Interna =</span> <span class="st">"internal"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-35"><a href="#cb43-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span>,<span class="dv">3</span><span class="sc">:</span><span class="dv">8</span>,<span class="dv">2</span>,<span class="dv">9</span>)</span>
<span id="cb43-36"><a href="#cb43-36" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(TABLE, <span class="st">"data/TRIPSorigem.Rds"</span>)</span>
<span id="cb43-37"><a href="#cb43-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-38"><a href="#cb43-38" aria-hidden="true" tabindex="-1"></a>Municipios <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="fu">url</span>(<span class="st">"https://github.com/U-Shift/MQAT/raw/main/data/Dicofre_names.Rds"</span>))</span>
<span id="cb43-39"><a href="#cb43-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-40"><a href="#cb43-40" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(Municipios, <span class="st">"data/Municipios_nomes.Rds"</span>)</span>
<span id="cb43-41"><a href="#cb43-41" aria-hidden="true" tabindex="-1"></a><span class="fu">write.table</span>(Municipios, <span class="st">"data/Municipios_nomes.txt"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>, <span class="at">sep =</span> <span class="st">"</span><span class="sc">\t</span><span class="st">"</span>)</span>
<span id="cb43-42"><a href="#cb43-42" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-43"><a href="#cb43-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-46"><a href="#cb43-46" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-47"><a href="#cb43-47" aria-hidden="true" tabindex="-1"></a><span class="co"># ler os dados diretamente em formato R dataset</span></span>
<span id="cb43-48"><a href="#cb43-48" aria-hidden="true" tabindex="-1"></a>TRIPS <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"data/TRIPSorigem.Rds"</span>)</span>
<span id="cb43-49"><a href="#cb43-49" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-50"><a href="#cb43-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-51"><a href="#cb43-51" aria-hidden="true" tabindex="-1"></a>::: callout-important</span>
<span id="cb43-52"><a href="#cb43-52" aria-hidden="true" tabindex="-1"></a>Note que √© muito importante compreender o R base, mesmo que as fun√ß√µes seguintes forne√ßam os mesmos resultados.</span>
<span id="cb43-53"><a href="#cb43-53" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-54"><a href="#cb43-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-55"><a href="#cb43-55" aria-hidden="true" tabindex="-1"></a>N√£o √© necess√°rio saber tudo!</span>
<span id="cb43-56"><a href="#cb43-56" aria-hidden="true" tabindex="-1"></a>E **n√£o precisa de saber de cor**.</span>
<span id="cb43-57"><a href="#cb43-57" aria-hidden="true" tabindex="-1"></a>As fun√ß√µes seguintes s√£o as que provavelmente utilizar√° na maior parte das vezes para tratar dados.</span>
<span id="cb43-58"><a href="#cb43-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-59"><a href="#cb43-59" aria-hidden="true" tabindex="-1"></a>::: {.callout-tip appearance="simple"}</span>
<span id="cb43-60"><a href="#cb43-60" aria-hidden="true" tabindex="-1"></a>Existem v√°rias formas de chegar √† mesma solu√ß√£o.</span>
<span id="cb43-61"><a href="#cb43-61" aria-hidden="true" tabindex="-1"></a>Aqui apresento apenas uma delas.</span>
<span id="cb43-62"><a href="#cb43-62" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-63"><a href="#cb43-63" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-64"><a href="#cb43-64" aria-hidden="true" tabindex="-1"></a><span class="fu">## Selecionar vari√°veis</span></span>
<span id="cb43-65"><a href="#cb43-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-66"><a href="#cb43-66" aria-hidden="true" tabindex="-1"></a>D√™ uma vista de olhos ao seu conjunto de dados.</span>
<span id="cb43-67"><a href="#cb43-67" aria-hidden="true" tabindex="-1"></a>Pode abrir a tabela utilizando <span class="in">`View()`</span>, ver a informa√ß√£o no painel ‚ÄúEnvironment‚Äù, ou mesmo *imprimir* o conte√∫do estruturado com <span class="in">`glimpse()`</span></span>
<span id="cb43-68"><a href="#cb43-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-71"><a href="#cb43-71" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-72"><a href="#cb43-72" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(TRIPS)</span>
<span id="cb43-73"><a href="#cb43-73" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-74"><a href="#cb43-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-75"><a href="#cb43-75" aria-hidden="true" tabindex="-1"></a>Vamos criar um novo conjunto de dados com *Origem*, *Walk,* *Bike* e *Total*.</span>
<span id="cb43-76"><a href="#cb43-76" aria-hidden="true" tabindex="-1"></a>Usamos a fun√ß√£o <span class="in">`select()`</span>.</span>
<span id="cb43-77"><a href="#cb43-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-80"><a href="#cb43-80" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-81"><a href="#cb43-81" aria-hidden="true" tabindex="-1"></a>TRIPS_new <span class="ot">=</span> <span class="fu">select</span>(TRIPS, Origem, Walk, Bike, Total) <span class="co"># o primeiro argumento √© a base de dados</span></span>
<span id="cb43-82"><a href="#cb43-82" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-83"><a href="#cb43-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-84"><a href="#cb43-84" aria-hidden="true" tabindex="-1"></a>Em R, o primeiro argumento √© normalmente referente ao conjunto de dados, e os restantes s√£o as colunas a selecionar.</span>
<span id="cb43-85"><a href="#cb43-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-86"><a href="#cb43-86" aria-hidden="true" tabindex="-1"></a>Com o <span class="in">`dplyr`</span> n√£o √© necess√°rio referir a <span class="in">`data$...`</span> , podemos simplesmente escrever os nomes das vari√°veis (e mesmo sem o <span class="in">`‚Äú...‚Äù`</span>!).</span>
<span id="cb43-87"><a href="#cb43-87" aria-hidden="true" tabindex="-1"></a>Isto torna o c√≥digo em R mais simples üôÇ</span>
<span id="cb43-88"><a href="#cb43-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-89"><a href="#cb43-89" aria-hidden="true" tabindex="-1"></a>Com o <span class="in">`select()`</span> podemos tamb√©m remover colunas que n√£o precisamos.</span>
<span id="cb43-90"><a href="#cb43-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-93"><a href="#cb43-93" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-94"><a href="#cb43-94" aria-hidden="true" tabindex="-1"></a>TRIPS_new <span class="ot">=</span> <span class="fu">select</span>(TRIPS_new, <span class="sc">-</span>Total) <span class="co"># deixar cair a vari√°vel Total</span></span>
<span id="cb43-95"><a href="#cb43-95" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-96"><a href="#cb43-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-97"><a href="#cb43-97" aria-hidden="true" tabindex="-1"></a><span class="fu">### Usando pipes!</span></span>
<span id="cb43-98"><a href="#cb43-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-99"><a href="#cb43-99" aria-hidden="true" tabindex="-1"></a>Agora vamos passar a usar os *pipes*.</span>
<span id="cb43-100"><a href="#cb43-100" aria-hidden="true" tabindex="-1"></a>Os *pipes* funcionam como uma regra: "**Com isto, faz isto.**"</span>
<span id="cb43-101"><a href="#cb43-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-102"><a href="#cb43-102" aria-hidden="true" tabindex="-1"></a>Isto √© √∫til para omitir o primeiro argumento das fun√ß√µes (normalmente o conjunto de dados para aplicar a fun√ß√£o).</span>
<span id="cb43-103"><a href="#cb43-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-104"><a href="#cb43-104" aria-hidden="true" tabindex="-1"></a>Com o mesmo exemplo do <span class="in">`select()`</span>, podemos escrever como:</span>
<span id="cb43-105"><a href="#cb43-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-108"><a href="#cb43-108" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-109"><a href="#cb43-109" aria-hidden="true" tabindex="-1"></a>TRIPS_new <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">select</span>(Origem, Walk, Bike, Total)</span>
<span id="cb43-110"><a href="#cb43-110" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-111"><a href="#cb43-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-112"><a href="#cb43-112" aria-hidden="true" tabindex="-1"></a>Duas coisas a **ter em conta**:</span>
<span id="cb43-113"><a href="#cb43-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-114"><a href="#cb43-114" aria-hidden="true" tabindex="-1"></a><span class="ss">1.  </span>O s√≠mbolo do *pipe* pode ser escrito como <span class="in">`|&gt;`</span> ou <span class="in">`%&gt;%`</span>.<span class="ot">[^data-manipulation-1]</span></span>
<span id="cb43-115"><a href="#cb43-115" aria-hidden="true" tabindex="-1"></a>    Para o escrever, pode tamb√©m utilizar o atalho <span class="in">`ctrl+shift+m`</span>.</span>
<span id="cb43-116"><a href="#cb43-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-117"><a href="#cb43-117" aria-hidden="true" tabindex="-1"></a><span class="ss">2.  </span>Depois de escrever <span class="in">`select(`</span> pode premir <span class="in">`tab`</span> e aparecer√° a lista de vari√°veis dispon√≠veis desse conjunto de dados! Prima <span class="in">`Enter`</span> para selecionar. Desta forma, evita erros de digita√ß√£o.</span>
<span id="cb43-118"><a href="#cb43-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-119"><a href="#cb43-119" aria-hidden="true" tabindex="-1"></a><span class="ot">[^data-manipulation-1]: </span>Pode alterar isto em RStudio <span class="sc">\&gt;</span> Tools <span class="sc">\&gt;</span> Global Options <span class="sc">\&gt;</span> Code.</span>
<span id="cb43-120"><a href="#cb43-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-121"><a href="#cb43-121" aria-hidden="true" tabindex="-1"></a><span class="fu">## Filtrar observa√ß√µes</span></span>
<span id="cb43-122"><a href="#cb43-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-123"><a href="#cb43-123" aria-hidden="true" tabindex="-1"></a>Podemos filtrar observa√ß√µes, com base numa condi√ß√£o, utilizando a fun√ß√£o <span class="in">`filter()`</span>.</span>
<span id="cb43-124"><a href="#cb43-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-127"><a href="#cb43-127" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-128"><a href="#cb43-128" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPS[TRIPS<span class="sc">$</span>Total <span class="sc">&gt;</span> <span class="dv">25000</span>,] <span class="co"># usando o r-base, n√£o se pode esquecer a v√≠rgula</span></span>
<span id="cb43-129"><a href="#cb43-129" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPS2 <span class="sc">|&gt;</span> <span class="fu">filter</span>(Total <span class="sc">&gt;</span> <span class="dv">25000</span>) <span class="co"># usando o dplyr, √© mais f√°cil</span></span>
<span id="cb43-130"><a href="#cb43-130" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-131"><a href="#cb43-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-132"><a href="#cb43-132" aria-hidden="true" tabindex="-1"></a>√â poss√≠vel ter outras condi√ß√µes dentro da condi√ß√£o.</span>
<span id="cb43-133"><a href="#cb43-133" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-136"><a href="#cb43-136" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-137"><a href="#cb43-137" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(TRIPS<span class="sc">$</span>Total)</span>
<span id="cb43-138"><a href="#cb43-138" aria-hidden="true" tabindex="-1"></a>TRIPS3 <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">filter</span>(Total <span class="sc">&gt;</span> <span class="fu">median</span>(Total)) </span>
<span id="cb43-139"><a href="#cb43-139" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-140"><a href="#cb43-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-141"><a href="#cb43-141" aria-hidden="true" tabindex="-1"></a>Outras condi√ß√µes de filtragem:</span>
<span id="cb43-142"><a href="#cb43-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-143"><a href="#cb43-143" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`==`</span> igual, <span class="in">`!=`</span> diferente</span>
<span id="cb43-144"><a href="#cb43-144" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`&lt;`</span> menor, <span class="in">`&gt;`</span> maior, <span class="in">`&lt;=`</span> menor ou igual, <span class="in">`&gt;=`</span> maior ou igual</span>
<span id="cb43-145"><a href="#cb43-145" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`&amp;`</span> e, <span class="in">`|`</span> ou</span>
<span id="cb43-146"><a href="#cb43-146" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`is.na`</span>, <span class="in">`!is.na`</span> n√£o √© NA</span>
<span id="cb43-147"><a href="#cb43-147" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span><span class="in">`%in%`</span>, <span class="in">`!%in%`</span> n√£o est√° em</span>
<span id="cb43-148"><a href="#cb43-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-149"><a href="#cb43-149" aria-hidden="true" tabindex="-1"></a><span class="fu">## Criar novas vari√°veis</span></span>
<span id="cb43-150"><a href="#cb43-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-151"><a href="#cb43-151" aria-hidden="true" tabindex="-1"></a>Tamb√©m podemos tentar criar uma vari√°vel de percentagem de viagens em autom√≥vel (*Car*) usando pipes!</span>
<span id="cb43-152"><a href="#cb43-152" aria-hidden="true" tabindex="-1"></a>Para criar uma nova vari√°vel ou alterar uma existente (overwrite), podemos usar a fun√ß√£o <span class="in">`mutate()`</span>.</span>
<span id="cb43-153"><a href="#cb43-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-156"><a href="#cb43-156" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-157"><a href="#cb43-157" aria-hidden="true" tabindex="-1"></a>TRIPS<span class="sc">$</span>Car_perc <span class="ot">=</span> TRIPS<span class="sc">$</span>Car<span class="sc">/</span>TRIPS<span class="sc">$</span>Total <span class="sc">*</span> <span class="dv">100</span> <span class="co"># com o r-base</span></span>
<span id="cb43-158"><a href="#cb43-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-159"><a href="#cb43-159" aria-hidden="true" tabindex="-1"></a>TRIPS <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">mutate</span>(<span class="at">Car_perc =</span> Car<span class="sc">/</span>Total <span class="sc">*</span> <span class="dv">100</span>) <span class="co"># com o dplyr</span></span>
<span id="cb43-160"><a href="#cb43-160" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-161"><a href="#cb43-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-162"><a href="#cb43-162" aria-hidden="true" tabindex="-1"></a><span class="fu">## Alterar o tipo de dados</span></span>
<span id="cb43-163"><a href="#cb43-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-164"><a href="#cb43-164" aria-hidden="true" tabindex="-1"></a>Os dados podem estar em diferentes formatos.</span>
<span id="cb43-165"><a href="#cb43-165" aria-hidden="true" tabindex="-1"></a>Por exemplo, a vari√°vel *Origem* tem os c√≥digos das freguesias como texto (*character*), mas podemos convert√™-la numa vari√°vel num√©rica.</span>
<span id="cb43-166"><a href="#cb43-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-169"><a href="#cb43-169" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-170"><a href="#cb43-170" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(TRIPS<span class="sc">$</span>Origem)</span>
<span id="cb43-171"><a href="#cb43-171" aria-hidden="true" tabindex="-1"></a>TRIPS <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> </span>
<span id="cb43-172"><a href="#cb43-172" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Origem_num =</span> <span class="fu">as.integer</span>(Origem)) <span class="co"># tamb√©m podemos usar as.numeric()</span></span>
<span id="cb43-173"><a href="#cb43-173" aria-hidden="true" tabindex="-1"></a><span class="fu">class</span>(TRIPS<span class="sc">$</span>Origem_num)</span>
<span id="cb43-174"><a href="#cb43-174" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-175"><a href="#cb43-175" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-176"><a href="#cb43-176" aria-hidden="true" tabindex="-1"></a>Os tipos de dados mais utilizados s√£o:</span>
<span id="cb43-177"><a href="#cb43-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-178"><a href="#cb43-178" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>inteiro / integer (<span class="in">`int`</span>)</span>
<span id="cb43-179"><a href="#cb43-179" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>num√©rico / numeric (<span class="in">`num`</span>)</span>
<span id="cb43-180"><a href="#cb43-180" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>texto/ character (<span class="in">`chr`</span>)</span>
<span id="cb43-181"><a href="#cb43-181" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>l√≥gico / logical (<span class="in">`logical`</span>)</span>
<span id="cb43-182"><a href="#cb43-182" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>data / date (<span class="in">`Date`</span>)</span>
<span id="cb43-183"><a href="#cb43-183" aria-hidden="true" tabindex="-1"></a><span class="ss">-   </span>factor (<span class="in">`factor`</span>)</span>
<span id="cb43-184"><a href="#cb43-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-185"><a href="#cb43-185" aria-hidden="true" tabindex="-1"></a><span class="fu">### Factores</span></span>
<span id="cb43-186"><a href="#cb43-186" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-187"><a href="#cb43-187" aria-hidden="true" tabindex="-1"></a>Os factores s√£o √∫teis para lidar com dados categ√≥ricos.</span>
<span id="cb43-188"><a href="#cb43-188" aria-hidden="true" tabindex="-1"></a>Podemos converter um texto num fator usando <span class="in">`as.factor()`</span>, e tamb√©m atribuir etiquetas e n√≠veis para dados categ√≥ricos ordinais.</span>
<span id="cb43-189"><a href="#cb43-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-190"><a href="#cb43-190" aria-hidden="true" tabindex="-1"></a>Podemos alterar a vari√°vel <span class="in">`Lisbon`</span> para um factor, e a vari√°vel <span class="in">`Internal`</span> tamb√©m.</span>
<span id="cb43-191"><a href="#cb43-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-194"><a href="#cb43-194" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-195"><a href="#cb43-195" aria-hidden="true" tabindex="-1"></a>TRIPS <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> </span>
<span id="cb43-196"><a href="#cb43-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Lisboa_factor =</span> <span class="fu">factor</span>(Lisboa, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"N√£o"</span>, <span class="st">"Sim"</span>)),</span>
<span id="cb43-197"><a href="#cb43-197" aria-hidden="true" tabindex="-1"></a>         <span class="at">Interna_factor =</span> <span class="fu">factor</span>(Interna, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Externa"</span>, <span class="st">"Interna"</span>)))</span>
<span id="cb43-198"><a href="#cb43-198" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-199"><a href="#cb43-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-200"><a href="#cb43-200" aria-hidden="true" tabindex="-1"></a>Mas como saber qual o n√≠vel que vem primeiro?</span>
<span id="cb43-201"><a href="#cb43-201" aria-hidden="true" tabindex="-1"></a>Uma forma simples √© utilizar as fun√ß√µes <span class="in">`table()`</span> ou <span class="in">`unique()`</span>.</span>
<span id="cb43-202"><a href="#cb43-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-205"><a href="#cb43-205" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-206"><a href="#cb43-206" aria-hidden="true" tabindex="-1"></a><span class="fu">unique</span>(TRIPS<span class="sc">$</span>Lisboa) <span class="co"># isto mostra todos os valores √∫nicos (diferentes)</span></span>
<span id="cb43-207"><a href="#cb43-207" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(TRIPS<span class="sc">$</span>Lisboa) <span class="co"># isto mostra a frequ√™ncia de cada valor</span></span>
<span id="cb43-208"><a href="#cb43-208" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(TRIPS<span class="sc">$</span>Lisboa_factor)</span>
<span id="cb43-209"><a href="#cb43-209" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-210"><a href="#cb43-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-211"><a href="#cb43-211" aria-hidden="true" tabindex="-1"></a>O primeiro n√∫mero a aparecer corresponde ao primeiro n√≠vel, e assim sucessivamente.</span>
<span id="cb43-212"><a href="#cb43-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-213"><a href="#cb43-213" aria-hidden="true" tabindex="-1"></a>Podemos ver a diferen√ßa entre usar uma vari√°vel cont√≠nua (neste caso, <span class="in">`Lisboa`</span> tem 0 e 1) e uma vari√°vel categ√≥rica (<span class="in">`Lisboa_factor`</span>).</span>
<span id="cb43-214"><a href="#cb43-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-217"><a href="#cb43-217" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-218"><a href="#cb43-218" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TRIPS<span class="sc">$</span>Lisboa) <span class="co"># os valores variam entre 0 e 1</span></span>
<span id="cb43-219"><a href="#cb43-219" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TRIPS<span class="sc">$</span>Lisboa_factor) <span class="co"># os valores s√£o categ√≥ricos e com etiquetas Sim/N√£o</span></span>
<span id="cb43-220"><a href="#cb43-220" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-221"><a href="#cb43-221" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-222"><a href="#cb43-222" aria-hidden="true" tabindex="-1"></a><span class="fu">## Juntar tabelas de dados</span></span>
<span id="cb43-223"><a href="#cb43-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-224"><a href="#cb43-224" aria-hidden="true" tabindex="-1"></a>Quando temos tabelas relacionais - ou seja, com um identificador comum - √© √∫til poder junt√°-las de uma forma eficiente.</span>
<span id="cb43-225"><a href="#cb43-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-226"><a href="#cb43-226" aria-hidden="true" tabindex="-1"></a>O <span class="in">`left_join`</span> √© uma fun√ß√£o que junta duas tabelas atrav√©s de **uma vari√°vel comum**.</span>
<span id="cb43-227"><a href="#cb43-227" aria-hidden="true" tabindex="-1"></a>A **primeira tabela √© a que ser√° mantida**, e a **segunda ser√° acrescentada a ela**.</span>
<span id="cb43-228"><a href="#cb43-228" aria-hidden="true" tabindex="-1"></a>Como funciona o <span class="in">`left_join`</span>:</span>
<span id="cb43-229"><a href="#cb43-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-230"><a href="#cb43-230" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="al">![Uma representa√ß√£o visual do `left_join` em que todas as linhas de x aparecem no resultado final, com mais informa√ß√£o junta de y. Fonte: @intror.](images/clipboard-1594422253.png)</span><span class="ot">{fig-align="center" width="424"}</span><span class="co">](https://r4ds.hadley.nz/joins#fig-join-left)</span></span>
<span id="cb43-231"><a href="#cb43-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-232"><a href="#cb43-232" aria-hidden="true" tabindex="-1"></a>Vamos ent√£o **juntar a lista de munic√≠pios √† nossa tabela**, atrav√©s de uma outra base de dados que inclui a **rela√ß√£o** entre o c√≥digo de freguesias (dicofre), o nome das freguesias e os respetivos munic√≠pios.</span>
<span id="cb43-233"><a href="#cb43-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-236"><a href="#cb43-236" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-237"><a href="#cb43-237" aria-hidden="true" tabindex="-1"></a>Municipios <span class="ot">=</span> <span class="fu">readRDS</span>(<span class="st">"data/Municipios_nomes.Rds"</span>)</span>
<span id="cb43-238"><a href="#cb43-238" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-239"><a href="#cb43-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-242"><a href="#cb43-242" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-243"><a href="#cb43-243" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TRIPS)</span>
<span id="cb43-244"><a href="#cb43-244" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(Municipios)</span>
<span id="cb43-245"><a href="#cb43-245" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-246"><a href="#cb43-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-247"><a href="#cb43-247" aria-hidden="true" tabindex="-1"></a>Podemos observar que as tabelas t√™m vari√°veis comuns: a <span class="in">`Origem`</span> em <span class="in">`TRIPS`</span> e o <span class="in">`Dicofre`</span> em <span class="in">`Municipios`</span>.</span>
<span id="cb43-248"><a href="#cb43-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-249"><a href="#cb43-249" aria-hidden="true" tabindex="-1"></a>Uma vez que o nome da vari√°vel n√£o √© o mesmo, para juntar estas duas tabelas precisamos de especificar a vari√°vel comum em cada tabela, utilizando o argumento <span class="in">`by`</span>.</span>
<span id="cb43-250"><a href="#cb43-250" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-253"><a href="#cb43-253" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-254"><a href="#cb43-254" aria-hidden="true" tabindex="-1"></a>TRIPSjoin <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">left_join</span>(Municipios, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"Origem"</span> <span class="ot">=</span> <span class="st">"Dicofre"</span>))</span>
<span id="cb43-255"><a href="#cb43-255" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-256"><a href="#cb43-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-257"><a href="#cb43-257" aria-hidden="true" tabindex="-1"></a>Se preferir, pode alterar ou renomear uma vari√°vel para que ambas as tabelas tenham o mesmo nome.</span>
<span id="cb43-258"><a href="#cb43-258" aria-hidden="true" tabindex="-1"></a>**Quando ambas as tabelas t√™m o mesmo nome de vari√°vel**, n√£o √© preciso especificar o argumento <span class="in">`by`</span>.</span>
<span id="cb43-259"><a href="#cb43-259" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-262"><a href="#cb43-262" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-263"><a href="#cb43-263" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb43-264"><a href="#cb43-264" aria-hidden="true" tabindex="-1"></a>Municipios <span class="ot">=</span> Municipios <span class="sc">|&gt;</span> <span class="fu">rename</span>(<span class="at">Origem =</span> <span class="st">"Dicofre"</span>) <span class="co"># alterar o nome da vari√°vel</span></span>
<span id="cb43-265"><a href="#cb43-265" aria-hidden="true" tabindex="-1"></a>TRIPSjoin <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">left_join</span>(Municipios) <span class="co"># detecta automativamente a vari√°vel comum</span></span>
<span id="cb43-266"><a href="#cb43-266" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-267"><a href="#cb43-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-268"><a href="#cb43-268" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Como √© poss√≠vel observar, as duas tabelas n√£o precisam de ter o mesmo n√∫mero de linhas (</span><span class="in">`nrow()`</span><span class="at">).</span></span>
<span id="cb43-269"><a href="#cb43-269" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; A fun√ß√£o </span><span class="in">`left_join`</span><span class="at"> mant√©m todas as observa√ß√µes da primeira tabela e junta a segunda tabela a esta.</span></span>
<span id="cb43-270"><a href="#cb43-270" aria-hidden="true" tabindex="-1"></a><span class="at">&gt; Se n√£o houver correspond√™ncia, as vari√°veis da segunda tabela ser√£o preenchidas com </span><span class="in">`NA`</span><span class="at">.</span></span>
<span id="cb43-271"><a href="#cb43-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-272"><a href="#cb43-272" aria-hidden="true" tabindex="-1"></a><span class="fu">## group_by e summarize</span></span>
<span id="cb43-273"><a href="#cb43-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-274"><a href="#cb43-274" aria-hidden="true" tabindex="-1"></a>Temos uma tabela grande com todas as freguesias da AML e os seus respectivos munic√≠pios.</span>
<span id="cb43-275"><a href="#cb43-275" aria-hidden="true" tabindex="-1"></a>Queremos agora saber o n√∫mero total de viagens com origem em cada munic√≠pio.</span>
<span id="cb43-276"><a href="#cb43-276" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-277"><a href="#cb43-277" aria-hidden="true" tabindex="-1"></a>Para facilitar, vamos manter apenas as vari√°veis de que precisamos para chegar ao resultado.</span>
<span id="cb43-278"><a href="#cb43-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-281"><a href="#cb43-281" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-282"><a href="#cb43-282" aria-hidden="true" tabindex="-1"></a>TRIPSredux <span class="ot">=</span> TRIPSjoin <span class="sc">|&gt;</span> <span class="fu">select</span>(Origem, Concelho, Interna, Car, Total)</span>
<span id="cb43-283"><a href="#cb43-283" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TRIPSredux)</span>
<span id="cb43-284"><a href="#cb43-284" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-285"><a href="#cb43-285" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-286"><a href="#cb43-286" aria-hidden="true" tabindex="-1"></a>Podemos agrupar esta tabela pela vari√°vel <span class="in">`Concelho`</span> e sumarizar (*summarize*) o n√∫mero de viagens com origem em cada munic√≠pio.</span>
<span id="cb43-287"><a href="#cb43-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-290"><a href="#cb43-290" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-291"><a href="#cb43-291" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb43-292"><a href="#cb43-292" aria-hidden="true" tabindex="-1"></a>TRIPSsum <span class="ot">=</span> TRIPSredux <span class="sc">|&gt;</span> </span>
<span id="cb43-293"><a href="#cb43-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Concelho) <span class="sc">|&gt;</span> <span class="co"># n√£o ir√° notar nenhuma altera√ß√£o na tabela</span></span>
<span id="cb43-294"><a href="#cb43-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total))</span>
<span id="cb43-295"><a href="#cb43-295" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TRIPSsum)</span>
<span id="cb43-296"><a href="#cb43-296" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-297"><a href="#cb43-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-298"><a href="#cb43-298" aria-hidden="true" tabindex="-1"></a>Som√°mos o n√∫mero total de viagens em cada munic√≠pio.</span>
<span id="cb43-299"><a href="#cb43-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-300"><a href="#cb43-300" aria-hidden="true" tabindex="-1"></a>Se quisermos agrupar por mais do que uma vari√°vel, podemos adicionar mais vari√°veis ao <span class="in">`group_by()`</span>.</span>
<span id="cb43-301"><a href="#cb43-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-304"><a href="#cb43-304" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-305"><a href="#cb43-305" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb43-306"><a href="#cb43-306" aria-hidden="true" tabindex="-1"></a>TRIPSsum2 <span class="ot">=</span> TRIPSredux <span class="sc">|&gt;</span> </span>
<span id="cb43-307"><a href="#cb43-307" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Concelho, Interna) <span class="sc">|&gt;</span> </span>
<span id="cb43-308"><a href="#cb43-308" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total),</span>
<span id="cb43-309"><a href="#cb43-309" aria-hidden="true" tabindex="-1"></a>            <span class="at">Car =</span> <span class="fu">sum</span>(Car))</span>
<span id="cb43-310"><a href="#cb43-310" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(TRIPSsum2)</span>
<span id="cb43-311"><a href="#cb43-311" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-312"><a href="#cb43-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-313"><a href="#cb43-313" aria-hidden="true" tabindex="-1"></a>Som√°mos o n√∫mero total de viagens e viagens em autom√≥vel para cada munic√≠pio, discriminadas por desloca√ß√µes internas e externas.</span>
<span id="cb43-314"><a href="#cb43-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-315"><a href="#cb43-315" aria-hidden="true" tabindex="-1"></a>::: {.callout-caution appearance="simple"}</span>
<span id="cb43-316"><a href="#cb43-316" aria-hidden="true" tabindex="-1"></a>√â uma boa pr√°tica utilizar a fun√ß√£o <span class="in">`ungroup()`</span> ap√≥s a fun√ß√£o <span class="in">`group_by()`</span>.</span>
<span id="cb43-317"><a href="#cb43-317" aria-hidden="true" tabindex="-1"></a>Isso remover√° o agrupamento.</span>
<span id="cb43-318"><a href="#cb43-318" aria-hidden="true" tabindex="-1"></a>Se n√£o o fizer, o agrupamento ser√° mantido e poder√° obter resultados inesperados na pr√≥xima vez que utilizar esse conjunto de dados.</span>
<span id="cb43-319"><a href="#cb43-319" aria-hidden="true" tabindex="-1"></a>:::</span>
<span id="cb43-320"><a href="#cb43-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-321"><a href="#cb43-321" aria-hidden="true" tabindex="-1"></a><span class="fu">## Organizar os dados</span></span>
<span id="cb43-322"><a href="#cb43-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-323"><a href="#cb43-323" aria-hidden="true" tabindex="-1"></a>Podemos **ordenar** (*sort*) um conjunto de dados por uma ou mais vari√°veis.</span>
<span id="cb43-324"><a href="#cb43-324" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-325"><a href="#cb43-325" aria-hidden="true" tabindex="-1"></a>Por exemplo, <span class="in">`arrange()`</span> por Total de viagens, na ordem ascendente ou descendente.</span>
<span id="cb43-326"><a href="#cb43-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-329"><a href="#cb43-329" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-330"><a href="#cb43-330" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPSsum2 <span class="sc">|&gt;</span> <span class="fu">arrange</span>(Total)</span>
<span id="cb43-331"><a href="#cb43-331" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPSsum2 <span class="sc">|&gt;</span> <span class="fu">arrange</span>(<span class="sc">-</span>Total) <span class="co"># descendente</span></span>
<span id="cb43-332"><a href="#cb43-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-333"><a href="#cb43-333" aria-hidden="true" tabindex="-1"></a>TRIPS2 <span class="ot">=</span> TRIPSsum2 <span class="sc">|&gt;</span> <span class="fu">arrange</span>(Concelho) <span class="co"># alfab√©tica</span></span>
<span id="cb43-334"><a href="#cb43-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-335"><a href="#cb43-335" aria-hidden="true" tabindex="-1"></a>TRIPS4 <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> <span class="fu">arrange</span>(Lisboa_factor, Total) <span class="co"># mais de uma vari√°vel</span></span>
<span id="cb43-336"><a href="#cb43-336" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-337"><a href="#cb43-337" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-338"><a href="#cb43-338" aria-hidden="true" tabindex="-1"></a>Isto n√£o √© o mesmo que abrir a tabela de visualiza√ß√£o e clicar nas setas das vari√°veis.</span>
<span id="cb43-339"><a href="#cb43-339" aria-hidden="true" tabindex="-1"></a>Quando se faz isso, a ordem n√£o √© guardada no conjunto de dados.</span>
<span id="cb43-340"><a href="#cb43-340" aria-hidden="true" tabindex="-1"></a>Se quiser guardar a ordem, dever√° usar a fun√ß√£o <span class="in">`arrange()`</span>.</span>
<span id="cb43-341"><a href="#cb43-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-342"><a href="#cb43-342" aria-hidden="true" tabindex="-1"></a><span class="fu">## All together now!</span></span>
<span id="cb43-343"><a href="#cb43-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-344"><a href="#cb43-344" aria-hidden="true" tabindex="-1"></a>Esta √© a magia dos *pipes*.</span>
<span id="cb43-345"><a href="#cb43-345" aria-hidden="true" tabindex="-1"></a>O pipe pega no √∫ltimo resultado e aplica-lhe a fun√ß√£o seguinte.</span>
<span id="cb43-346"><a href="#cb43-346" aria-hidden="true" tabindex="-1"></a>‚ÄúCom isto, faz isto.‚Äù.</span>
<span id="cb43-347"><a href="#cb43-347" aria-hidden="true" tabindex="-1"></a>Podemos encadear as fun√ß√µes que quisermos.</span>
<span id="cb43-348"><a href="#cb43-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-351"><a href="#cb43-351" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-352"><a href="#cb43-352" aria-hidden="true" tabindex="-1"></a><span class="co">#| message: false</span></span>
<span id="cb43-353"><a href="#cb43-353" aria-hidden="true" tabindex="-1"></a>TRIPS_pipes <span class="ot">=</span> TRIPS <span class="sc">|&gt;</span> </span>
<span id="cb43-354"><a href="#cb43-354" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Origem, Interna, Car, Total) <span class="sc">|&gt;</span> </span>
<span id="cb43-355"><a href="#cb43-355" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-356"><a href="#cb43-356" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Dicofre =</span> Origem) <span class="sc">|&gt;</span> </span>
<span id="cb43-357"><a href="#cb43-357" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Interna_factor =</span> <span class="fu">factor</span>(Interna, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Externa"</span>, <span class="st">"Interna"</span>))) <span class="sc">|&gt;</span> </span>
<span id="cb43-358"><a href="#cb43-358" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-359"><a href="#cb43-359" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Interna_factor <span class="sc">==</span> <span class="st">"Interna"</span>)<span class="sc">|&gt;</span></span>
<span id="cb43-360"><a href="#cb43-360" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-361"><a href="#cb43-361" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(Municipios) <span class="sc">|&gt;</span></span>
<span id="cb43-362"><a href="#cb43-362" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-363"><a href="#cb43-363" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Concelho) <span class="sc">|&gt;</span></span>
<span id="cb43-364"><a href="#cb43-364" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">Total =</span> <span class="fu">sum</span>(Total),</span>
<span id="cb43-365"><a href="#cb43-365" aria-hidden="true" tabindex="-1"></a>            <span class="at">Car =</span> <span class="fu">sum</span>(Car),</span>
<span id="cb43-366"><a href="#cb43-366" aria-hidden="true" tabindex="-1"></a>            <span class="at">Car_perc =</span> Car<span class="sc">/</span>Total <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-367"><a href="#cb43-367" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb43-368"><a href="#cb43-368" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb43-369"><a href="#cb43-369" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Car_perc))</span>
<span id="cb43-370"><a href="#cb43-370" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-371"><a href="#cb43-371" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-372"><a href="#cb43-372" aria-hidden="true" tabindex="-1"></a>Com este c√≥digo, teremos uma tabela com o n√∫mero total de viagens intramunicipais, por munic√≠pio, com os seus nomes em vez de c√≥digos, ordenados pela percentagem de viagens em autom√≥vel.</span>
<span id="cb43-373"><a href="#cb43-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-376"><a href="#cb43-376" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-377"><a href="#cb43-377" aria-hidden="true" tabindex="-1"></a>TRIPS_pipes</span>
<span id="cb43-378"><a href="#cb43-378" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-379"><a href="#cb43-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-380"><a href="#cb43-380" aria-hidden="true" tabindex="-1"></a><span class="fu">## Outras fun√ß√µes do dplyr</span></span>
<span id="cb43-381"><a href="#cb43-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-382"><a href="#cb43-382" aria-hidden="true" tabindex="-1"></a>Pode explorar outras fun√ß√µes e varia√ß√µes do <span class="in">`dplyr`</span> para manipula√ß√£o de dados na **dplyr cheatsheet**:</span>
<span id="cb43-383"><a href="#cb43-383" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-384"><a href="#cb43-384" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="al">![](images/clipboard-2101323289.png)</span><span class="co">](https://rstudio.github.io/cheatsheets/data-transformation.pdf)</span></span>
<span id="cb43-385"><a href="#cb43-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-386"><a href="#cb43-386" aria-hidden="true" tabindex="-1"></a>Take a particular attention to <span class="in">`pivot_wider`</span> and <span class="in">`pivot_longer`</span> (<span class="co">[</span><span class="ot">`tidyr`</span><span class="co">](https://tidyr.tidyverse.org/articles/pivot.html)</span> package) to transform **OD matrices** in **wide** and **long** formats.</span>
<span id="cb43-387"><a href="#cb43-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-388"><a href="#cb43-388" aria-hidden="true" tabindex="-1"></a>Tome especial aten√ß√£o a <span class="in">`pivot_wider`</span> e <span class="in">`pivot_longer`</span> (pacote <span class="co">[</span><span class="ot">`tidyr`</span><span class="co">](https://tidyr.tidyverse.org/articles/pivot.html)</span> ) para transformar **matrizes OD** em formatos largos (*wide*) ou longos (*long*).</span>
<span id="cb43-389"><a href="#cb43-389" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-392"><a href="#cb43-392" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-393"><a href="#cb43-393" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb43-394"><a href="#cb43-394" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb43-395"><a href="#cb43-395" aria-hidden="true" tabindex="-1"></a>pivot <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">Origens =</span> <span class="fu">c</span>(<span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"C"</span>),</span>
<span id="cb43-396"><a href="#cb43-396" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Destinos =</span> <span class="fu">c</span>(<span class="st">"B"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>, <span class="st">"C"</span>, <span class="st">"A"</span>),</span>
<span id="cb43-397"><a href="#cb43-397" aria-hidden="true" tabindex="-1"></a>                   <span class="at">Viagens =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">45</span>, <span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">30</span>))</span>
<span id="cb43-398"><a href="#cb43-398" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(pivot, <span class="at">caption =</span> <span class="st">"Matriz OD em formato longo"</span>)</span>
<span id="cb43-399"><a href="#cb43-399" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-400"><a href="#cb43-400" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-403"><a href="#cb43-403" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-404"><a href="#cb43-404" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb43-405"><a href="#cb43-405" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: true</span></span>
<span id="cb43-406"><a href="#cb43-406" aria-hidden="true" tabindex="-1"></a>matrix <span class="ot">=</span> pivot <span class="sc">|&gt;</span> </span>
<span id="cb43-407"><a href="#cb43-407" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Destinos,</span>
<span id="cb43-408"><a href="#cb43-408" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">values_from =</span> Viagens,</span>
<span id="cb43-409"><a href="#cb43-409" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">names_sort =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb43-410"><a href="#cb43-410" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">Viagens =</span> <span class="st">"Origens"</span>)</span>
<span id="cb43-411"><a href="#cb43-411" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(matrix, <span class="at">caption =</span> <span class="st">"matriz OD em formato wide"</span>)</span>
<span id="cb43-412"><a href="#cb43-412" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb43-413"><a href="#cb43-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-416"><a href="#cb43-416" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb43-417"><a href="#cb43-417" aria-hidden="true" tabindex="-1"></a><span class="co">#| include: false</span></span>
<span id="cb43-418"><a href="#cb43-418" aria-hidden="true" tabindex="-1"></a><span class="co">#| echo: false</span></span>
<span id="cb43-419"><a href="#cb43-419" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb43-420"><a href="#cb43-420" aria-hidden="true" tabindex="-1"></a><span class="co"># this converts this quarto to a plain r script</span></span>
<span id="cb43-421"><a href="#cb43-421" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">purl</span>(<span class="st">"data-manipulation.qmd"</span>, <span class="st">"code/tratamento-dados.R"</span>, <span class="at">documentation =</span> <span class="dv">0</span>)</span>
<span id="cb43-422"><a href="#cb43-422" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copiar para a √°rea de transfer√™ncia" class="code-copy-button" data-in-quarto-modal=""><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>R F√©lix</p>
</div>   
    <div class="nav-footer-center">
<p>PG Mobilidade 360</p>
</div>
    <div class="nav-footer-right">
<p>Novembro 2024</p>
</div>
  </div>
</footer>




</body></html>